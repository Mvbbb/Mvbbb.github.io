{"title":"Linux服务器安装 MySql 8.0并配置远程连接","date":"2020-11-05T13:04:14.000Z","date_formatted":{"ll":"Nov 5, 2020","L":"11/05/2020","MM-DD":"11-05"},"link":"sb74kg","comments":true,"categories":["教程与记录"],"updated":"2021-02-03T04:20:59.377Z","content":"<p>配置了一个下午, 终于配置成功了, 决定把今天遇到的坑都写下来<br>\n<img src=\"https://cdn.nlark.com/yuque/0/2020/png/1552854/1604581632853-dd30b637-a843-4b71-889c-ccebea99c75c.png#align=left&amp;display=inline&amp;height=119&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=238&amp;originWidth=1199&amp;size=34794&amp;status=done&amp;style=none&amp;width=599.5\" alt=\"image.png\"></p>\n<a id=\"more\"></a>\n<h1 id=\"教程\">教程<a title=\"#教程\" href=\"#教程\"></a></h1>\n<p>只针对 Mysql 8, centos7/Ubuntu20<br>\n1 . 使用宝塔面板傻瓜式安装 MySql8.0<br>\n2 . 在宝塔-安全处发行 3306 端口, 并且在服务器厂商处放行 3306 端口<br>\n<img src=\"https://cdn.nlark.com/yuque/0/2020/png/1552854/1604581656064-9c15f40e-b577-4f4c-aea8-c6db26e90fb5.png#align=left&amp;display=inline&amp;height=182&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=363&amp;originWidth=1647&amp;size=36497&amp;status=done&amp;style=none&amp;width=823.5\" alt=\"image.png\"></p>\n<ul>\n<li><img src=\"https://cdn.nlark.com/yuque/0/2020/png/1552854/1604581684329-30e3cd82-1bdb-4275-96e2-ffe683b8506f.png#align=left&amp;display=inline&amp;height=88&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=176&amp;originWidth=1637&amp;size=21648&amp;status=done&amp;style=none&amp;width=818.5\" alt=\"image.png\" class=\"φcx\"></li>\n</ul>\n<p>3 . 修改配置, 可以直接在宝塔 Mysql 进行配置修改, 在 [mysqld] 下面添加 <code>skip-grant-tables</code> 跳过安全检查. 重启服务器.<br>\n4 . 在云主机提供的终端进行以下命令操作<br>\n<img src=\"https://cdn.nlark.com/yuque/0/2020/png/1552854/1608095806879-a5b18c29-5fea-43aa-9179-26742cca7e32.png#align=left&amp;display=inline&amp;height=430&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=859&amp;originWidth=1466&amp;size=141616&amp;status=done&amp;style=none&amp;width=733\" alt=\"image.png\"><br>\n5 . 登录 Mysql , 修改 root 用户的远程访问权限并修改密码</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 输入之后直接回车, 默认没有密码</span><br><span class=\"line\">mysql <span class=\"operator\">-</span>u root</span><br><span class=\"line\"># 使用 Mysql 数据库</span><br><span class=\"line\">use mysql;</span><br><span class=\"line\"># 查看用户访问端口. root 的host是 localhost, 只允许本地访问, 不允许远程访问, 如果没有root账户需要手动添加, 查看文末链接</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"keyword\">user</span>,host <span class=\"keyword\">from</span> <span class=\"keyword\">user</span>;</span><br><span class=\"line\"># 修改访问端口</span><br><span class=\"line\"><span class=\"keyword\">update</span> <span class=\"keyword\">user</span> <span class=\"keyword\">set</span> host <span class=\"operator\">=</span> <span class=\"string\">&#x27;%&#x27;</span> <span class=\"keyword\">where</span> <span class=\"keyword\">user</span> <span class=\"operator\">=</span> <span class=\"string\">&#x27;root&#x27;</span>;</span><br><span class=\"line\"># 刷新服务配置项</span><br><span class=\"line\">FLUSH PRIVILEGES;</span><br><span class=\"line\"># 再次查看 root 的host, 发现变成了 <span class=\"operator\">%</span></span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"keyword\">user</span>,host <span class=\"keyword\">from</span> <span class=\"keyword\">user</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"># 修改 root 用户的密码, 如果出现因为处于 &quot;--skip-grant-tables&quot; 模式而产生的限制, 先执行一次 FLUSH PRIVILEGES;</span><br><span class=\"line\"><span class=\"keyword\">ALTER</span> <span class=\"keyword\">USER</span> <span class=\"string\">&#x27;root&#x27;</span>@<span class=\"string\">&#x27;%&#x27;</span> IDENTIFIED <span class=\"keyword\">WITH</span> MYSQL_NATIVE_PASSWORD <span class=\"keyword\">BY</span> <span class=\"string\">&#x27;新密码&#x27;</span>;</span><br><span class=\"line\"># 退出, 将 &quot;--skip-grant-tables&quot; 属性注释了</span><br><span class=\"line\">vi <span class=\"operator\">/</span>etc<span class=\"operator\">/</span>my.cnf</span><br></pre></td></tr></table></figure>\n<p>6 . 测试新密码是否可以登录</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql <span class=\"operator\">-</span>uroot <span class=\"operator\">-</span>p密码</span><br></pre></td></tr></table></figure>\n<p>7 . 重启 MySQL</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">service mysql restart</span><br><span class=\"line\">service</span><br></pre></td></tr></table></figure>\n<p>8 . 在本机 cmd 测试是否可以远程登录</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql <span class=\"operator\">-</span>h<span class=\"operator\">&lt;</span>主机公网IP<span class=\"operator\">&gt;</span> <span class=\"operator\">-</span>uroot <span class=\"operator\">-</span>p<span class=\"operator\">&lt;</span>新密码<span class=\"operator\">&gt;</span></span><br></pre></td></tr></table></figure>\n<p>9 . 之后就可以使用远程连接工具来连接服务器了 Navicat 之类的</p>\n<h1 id=\"坑与细节\">坑与细节<a title=\"#坑与细节\" href=\"#坑与细节\"></a></h1>\n<p>看了别的教程, 觉得不同的 MySql 版本之间的差异还是挺大的, 许多方法在不同的 Mysql 版本中不兼容.<br>\n坑如下:</p>\n<ol>\n<li>使用服务器终端输入 <code>mysql -u root</code> 之后显示 <code>PermissionDenied</code> 认证失败<br>\n解决方案: 在 <code>/etc/my.cnf</code> 下的 [mysqld] 添加一行 <code>--skip-grant-tables</code></li>\n<li>可以在服务器终端成功登录, 关闭防火墙也没用, 无法在远程登录, 执行<code>netstat -an | grep 3306</code> 或者 <code>lsof -i :3306</code> 没有反应, 3306 端口没有被占用<br>\n出现这个情况是因为现在 Mysql 处于 ‘skip-grant-tables’ 模式</li>\n<li>远程连接报错 <code>ERROR 2003 (HY000): Can't connect to MySQL server on</code><br>\n按照别的教程大多都是到配置文件注释 <code>bind-address</code>, 但是在 mysql 8 中已经没有这个配置了. 其实主要就是 Mysql 处于 <code>--skip-grant-tables</code> 模式, 按照上面的教程步骤来</li>\n<li>有的教程使用 <code>UPDATE user SET Password = PASSWORD('newpass') WHERE user = 'root';</code> 来更新密码, MySql 报语法错误<br>\n首先 Mysql8 的密码字段名不是 password, 而是 <code>mysql_native_password</code> .其次不是使用的 password 函数. 更改密码的命令应该使用</li>\n</ol>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">ALTER</span> <span class=\"keyword\">USER</span> <span class=\"string\">&#x27;test&#x27;</span>@<span class=\"string\">&#x27;localhost&#x27;</span> IDENTIFIED <span class=\"keyword\">WITH</span> MYSQL_NATIVE_PASSWORD <span class=\"keyword\">BY</span> <span class=\"string\">&#x27;新密码&#x27;</span>;</span><br></pre></td></tr></table></figure>\n<p>参考:</p>\n<p><a href=\"https://www.cnblogs.com/zyhcs/p/13866873.html\" target=\"_blank\" rel=\"external nofollow noopener\">Navicat 连接远程 MySQL8.0 数据库</a><br>\n<a href=\"https://blog.csdn.net/weixin_43671497/article/details/84931578\" target=\"_blank\" rel=\"external nofollow noopener\">Linux 下 mysql 服务存在，但是 3306 端口监听不存在，远程连接不上</a><br>\n<a href=\"https://blog.csdn.net/niuchenliang524/article/details/104607496/\" target=\"_blank\" rel=\"external nofollow noopener\">Mysql 中 root 账户丢失</a></p>\n","prev":{"title":"近期规划-碎碎念","link":"gmx84f"},"next":{"title":"内存管理","link":"ldcb18"},"plink":"https://mvbbb.github.io/sb74kg/","toc":[{"id":"教程","title":"教程","index":"1"},{"id":"坑与细节","title":"坑与细节","index":"2"}],"copyright":{"author":"Mvbbb","link":"<a href=\"https://mvbbb.github.io/sb74kg/\" title=\"Linux服务器安装 MySql 8.0并配置远程连接\">https://mvbbb.github.io/sb74kg/</a>","license":"Attribution-NonCommercial-NoDerivatives 4.0 International (<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow noopener\" target=\"_blank\">CC BY-NC-ND 4.0</a>)"}}